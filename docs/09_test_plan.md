# テスト計画書・テスト仕様書

| 項目 | 内容 |
|------|------|
| システム名 | お天気チェッカー（Weather App） |
| バージョン | 1.0 |
| 作成日 | 2026-02-17 |

---

## 1. テスト方針

### 1.1 現状

現バージョンではテストスイートが未構築のため、手動テストを主体として品質を担保する。今後、Jest・React Testing Library・Playwrightの導入を推奨する。

### 1.2 テストの優先順位

| 優先度 | 対象 | 理由 |
|--------|------|------|
| 高 | 認証フロー | アクセス制御が失敗するとセキュリティリスク |
| 高 | 天気検索機能 | アプリのコア機能 |
| 中 | AI機能 | 外部API依存、エラーハンドリングの確認 |
| 低 | UI表示 | 視覚的確認が主体 |

---

## 2. テスト種別

| 種別 | 方式 | 目的 |
|------|------|------|
| 単体テスト | 自動（未導入） | 関数・コンポーネントの動作確認 |
| 結合テスト | 手動 | API呼び出し・ページ遷移の確認 |
| E2Eテスト | 手動 | ユーザーシナリオの全体確認 |
| レスポンシブテスト | 手動 | 各デバイスサイズでの表示確認 |
| セキュリティテスト | 手動 | 認証バイパスの試行確認 |

---

## 3. 手動テスト仕様

### 3.1 認証テスト

#### TC-AUTH-01: Googleログイン成功

| 項目 | 内容 |
|------|------|
| 前提条件 | ログアウト状態、有効なGoogleアカウントがある |
| 手順 | 1. `http://localhost:3000` にアクセス<br>2. 「Googleでログイン」ボタンをクリック<br>3. Googleアカウントを選択して認証 |
| 期待結果 | `/home` にリダイレクトされ、ヘッダーにアバターが表示される |

#### TC-AUTH-02: ログイン済みでトップページアクセス

| 項目 | 内容 |
|------|------|
| 前提条件 | ログイン済みの状態 |
| 手順 | ブラウザで `http://localhost:3000/` に直接アクセス |
| 期待結果 | `/home` に自動リダイレクトされる |

#### TC-AUTH-03: 未認証で保護ページへのアクセス

| 項目 | 内容 |
|------|------|
| 前提条件 | ログアウト状態 |
| 手順 | ブラウザで `http://localhost:3000/home` に直接アクセス |
| 期待結果 | `/` にリダイレクトされ、ログイン画面が表示される |

#### TC-AUTH-04: ログアウト

| 項目 | 内容 |
|------|------|
| 前提条件 | ログイン済みの状態 |
| 手順 | ヘッダーの「ログアウト」ボタンをクリック |
| 期待結果 | セッションが破棄されて `/` にリダイレクトされる |

#### TC-AUTH-05: マイページへのナビゲーション

| 項目 | 内容 |
|------|------|
| 前提条件 | ログイン済み |
| 手順 | ヘッダーのアバター画像をクリック |
| 期待結果 | `/mypage` に遷移する |

---

### 3.2 天気検索テスト（都市名）

#### TC-WEATHER-01: 正常な都市名検索

| 項目 | 内容 |
|------|------|
| 前提条件 | ログイン済み、/home 表示中 |
| 手順 | 1. 都市選択欄をクリック<br>2. 「東京」を選択<br>3. 「検索」ボタンをクリック |
| 期待結果 | 天気概況と気温が表示される。AI分析スピナーが表示された後、コメントとスコアが表示される |

#### TC-WEATHER-02: 都市未選択で検索ボタンクリック

| 項目 | 内容 |
|------|------|
| 前提条件 | ログイン済み、都市未選択 |
| 手順 | 「検索」ボタンをクリック |
| 期待結果 | アラート「都市を選択してください」が表示される |

#### TC-WEATHER-03: オートコンプリートの動作

| 項目 | 内容 |
|------|------|
| 前提条件 | ログイン済み |
| 手順 | 1. 都市入力欄に「大」と入力<br>2. ドロップダウンが表示されるか確認 |
| 期待結果 | 「大阪 (Osaka)」等の候補がドロップダウンに表示される |

---

### 3.3 天気検索テスト（現在地）

#### TC-GPS-01: 現在地検索（許可）

| 項目 | 内容 |
|------|------|
| 前提条件 | ブラウザで位置情報を許可 |
| 手順 | 「現在地から検索」ボタンをクリック → 位置情報を許可 |
| 期待結果 | 現在地の天気・気温・地名が表示される。緯度・経度も表示される |

#### TC-GPS-02: 現在地検索（拒否）

| 項目 | 内容 |
|------|------|
| 前提条件 | ブラウザで位置情報を拒否 |
| 手順 | 「現在地から検索」ボタンをクリック → 位置情報を拒否 |
| 期待結果 | アラート「位置情報の取得を許可するか、設定を確認してください」が表示される |

#### TC-GPS-03: 都市検索後の現在地検索

| 項目 | 内容 |
|------|------|
| 前提条件 | 都市名で天気を表示済みの状態 |
| 手順 | 「現在地から検索」をクリック |
| 期待結果 | 都市選択がリセットされ、現在地の天気に切り替わる |

---

### 3.4 AI機能テスト

#### TC-AI-01: AI分析の正常表示

| 項目 | 内容 |
|------|------|
| 前提条件 | 天気検索が完了した状態 |
| 確認内容 | AI分析中はスピナー＋スケルトンUIが表示され、完了後にコメントと4項目スコアが表示される |

#### TC-AI-02: AIスコアの星表示

| 項目 | 内容 |
|------|------|
| 確認内容 | スコア1〜5に対応して、★★★★★形式で正しく表示される |

#### TC-AI-03: AIエラー時の表示

| 項目 | 内容 |
|------|------|
| 手順 | `GEMINI_API_KEY`を一時的に無効にして天気検索を実行 |
| 期待結果 | AIカードが表示されない（エラー時はnull返却） |

---

### 3.5 UIレスポンシブテスト

#### TC-UI-01: スマートフォン表示（375px）

| 確認項目 | 期待結果 |
|---------|---------|
| ヘッダー | ユーザー名・メールが非表示。アバター・ログアウトが表示される |
| タイトル | `text-3xl`（30px）サイズで表示 |
| ボタン | 「検索」「現在地から検索」が縦並びで表示 |
| 横スクロール | 発生しない |

#### TC-UI-02: PC表示（1024px以上）

| 確認項目 | 期待結果 |
|---------|---------|
| ヘッダー | ユーザー名・メール・アバター・ログアウトが全表示 |
| タイトル | `text-5xl`（48px）サイズで表示 |
| ボタン | 「検索」「現在地から検索」が横並びで表示 |

#### TC-UI-03: AIカードのローディング表示

| 確認項目 | 期待結果 |
|---------|---------|
| スピナー | 青いSVGサークルが回転するアニメーション |
| スケルトン | コメント部分（2行）とスコア部分（4行）がパルスアニメーション |

---

### 3.6 ナビゲーションテスト

#### TC-NAV-01: ヘッダーのアプリ名クリック

| 手順 | ホーム画面でヘッダーの「お天気チェッカー」テキストをクリック |
|------|------|
| 期待結果 | `/home` に遷移する（または既に `/home` の場合はリロード） |

#### TC-NAV-02: マイページからホームへ戻る

| 手順 | マイページでヘッダーのアプリ名をクリック |
|------|------|
| 期待結果 | `/home` に遷移する |

---

## 4. 自動テスト導入計画（推奨）

現在未実装だが、以下のツールを使った自動テストの導入を推奨する。

### 4.1 推奨テストツール

| ツール | 対象 | 用途 |
|--------|------|------|
| Jest | ユニットテスト | 関数・ユーティリティのテスト |
| React Testing Library | コンポーネントテスト | UIコンポーネントの動作確認 |
| Playwright | E2Eテスト | ユーザーシナリオの自動化 |
| MSW（Mock Service Worker） | APIモック | 外部API依存を排除したテスト |

### 4.2 導入コマンド例

```bash
# Jest + React Testing Library
npm install --save-dev jest @testing-library/react @testing-library/jest-dom jest-environment-jsdom

# Playwright
npm install --save-dev @playwright/test
npx playwright install
```

### 4.3 優先して実装すべきテストケース

1. `AiCommentCard`のローディング・エラー・正常表示の単体テスト
2. `WeatherSection`の`handleSearch`・`handleSearchToPosition`のユニットテスト（APIをモック）
3. 認証フローのE2Eテスト（Playwright）

---

## 5. テスト環境

| 項目 | 内容 |
|------|------|
| テスト実行環境 | 開発環境（`localhost:3000`） |
| ブラウザ | Chrome（最新）、Safari（最新）、Firefox（最新） |
| デバイス | Chrome DevToolsのDevice Emulationでスマホ表示を確認（iPhone SE: 375px） |
| 外部API | 実環境のAPIを使用（モック未実装） |

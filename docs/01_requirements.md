# 要件定義書

| 項目 | 内容 |
|------|------|
| システム名 | お天気チェッカー（Weather App） |
| バージョン | 1.0 |
| 作成日 | 2026-02-17 |
| ステータス | 運用中 |

---

## 1. 目的・背景

### 1.1 システムの目的

ユーザーが日常的に天気情報を手軽に確認できるWebアプリケーションを提供する。単なる天気表示にとどまらず、AI（Google Gemini）による生活活動アドバイスを組み合わせることで、ユーザーの行動判断を支援することを目的とする。

### 1.2 背景

- スマートフォン・PCどちらからでもブラウザだけで使えるシンプルな天気確認ツールへの需要がある
- 気温・天気だけでなく「今日は洗濯できるか」「運動に向いているか」などの実用的なアドバイスをAIで自動生成したい
- Google認証によるログイン機能を設けることで、将来的なパーソナライズ機能（お気に入り都市の保存など）への拡張を見据える

---

## 2. ステークホルダー

| 役割 | 説明 |
|------|------|
| エンドユーザー | Googleアカウントを持つ一般ユーザー。天気情報を日常的に確認したい人 |
| 開発者・運用者 | アプリケーションの開発・保守を行う担当者 |

---

## 3. スコープ

### 3.1 本システムが対象とすること

- Googleアカウントを用いたユーザー認証
- 都市名を選択して天気情報を表示する機能
- GPS（現在地）から天気情報を取得する機能
- AIによる天気コメント・活動スコアの生成
- ユーザープロフィール（マイページ）の表示

### 3.2 本システムが対象としないこと（現バージョン）

- お気に入り都市の保存・管理
- 天気予報（翌日以降の予報表示）
- プッシュ通知
- 天気履歴の保存・閲覧
- 課金・サブスクリプション機能

---

## 4. 機能要件

### 4.1 認証機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| F-01 | Googleログイン | Google OAuth 2.0を使用したソーシャルログイン | 必須 |
| F-02 | セッション管理 | ログイン状態を維持するセッション管理 | 必須 |
| F-03 | ログアウト | セッションを破棄してログイン画面へリダイレクト | 必須 |
| F-04 | 未認証リダイレクト | 未ログイン状態でのページアクセス時はログインページへ誘導 | 必須 |

### 4.2 天気検索機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| F-05 | 都市名検索 | プルダウン（オートコンプリート）から都市を選択して天気を表示 | 必須 |
| F-06 | 現在地検索 | ブラウザのGeolocation APIで取得した緯度・経度から天気を取得 | 必須 |
| F-07 | 天気情報表示 | 天気概況（例：晴れ・曇り）と気温（℃）を表示 | 必須 |
| F-08 | 現在地名表示 | 現在地検索時はAPIから取得した地名を表示 | 必須 |

### 4.3 AI機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| F-09 | AIコメント生成 | 天気・気温・都市に基づいて服装・持ち物・活動アドバイスを生成 | 必須 |
| F-10 | 活動スコア表示 | 外出・運動・洗濯・ドライブの4項目を1〜5段階で評価し表示 | 必須 |
| F-11 | ロード状態表示 | AI生成中はスピナー＋スケルトンUIを表示する | 必須 |
| F-12 | エラーハンドリング | AI生成失敗時はエラー表示（カード非表示） | 必須 |

### 4.4 画面・ナビゲーション

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| F-13 | ログイン画面 | Googleログインボタンを表示するランディングページ | 必須 |
| F-14 | ホーム画面 | 天気検索・表示のメインページ | 必須 |
| F-15 | マイページ | ログインユーザーのプロフィール確認ページ | 通常 |
| F-16 | ヘッダーナビゲーション | アプリ名クリックでホームへ、アバタークリックでマイページへ遷移 | 必須 |

---

## 5. 非機能要件

### 5.1 パフォーマンス要件

| 項目 | 目標値 | 備考 |
|------|--------|------|
| 天気データ取得レスポンス | 3秒以内 | OpenWeatherMap API依存 |
| AI生成レスポンス | 10秒以内 | Gemini API依存 |
| 都市リスト取得 | 2秒以内 | Supabaseキャッシュ（1時間）あり |
| ページ初期表示 | 2秒以内 | Next.js SSR |

### 5.2 可用性要件

| 項目 | 目標値 |
|------|--------|
| システム稼働率 | 99%以上（ホスティングサービス依存） |
| 計画外ダウンタイム | 月1時間以内 |
| 外部API障害時 | エラーメッセージを適切に表示し、UI崩壊を防ぐ |

### 5.3 セキュリティ要件

| 項目 | 要件 |
|------|------|
| 認証方式 | OAuth 2.0（Google） |
| 通信暗号化 | HTTPS必須（本番環境） |
| APIキー管理 | 環境変数（`.env.local`）で管理、クライアントサイドへの露出禁止 |
| ミドルウェア認証 | `/home` 配下への未認証アクセスをサーバーサイドでブロック |
| セッションシークレット | `AUTH_SECRET`環境変数で管理 |

### 5.4 ユーザビリティ要件

| 項目 | 要件 |
|------|------|
| レスポンシブ対応 | スマートフォン（375px〜）・タブレット・PCに対応 |
| ローディング表示 | 非同期処理中はスピナー・スケルトンUIで状態を明示 |
| エラーメッセージ | ユーザーが理解できる日本語でエラーを表示 |
| アクセシビリティ | スクリーンリーダー対応（aria-label等） |

### 5.5 保守性要件

| 項目 | 要件 |
|------|------|
| コード品質 | TypeScriptによる型安全性の確保 |
| Lint | ESLint（Next.js設定）によるコード品質チェック |
| 環境分離 | `.env.local`で環境変数を管理し、本番と開発を分離 |
| コンポーネント分離 | 機能ごとにコンポーネントを分割し再利用性を確保 |

---

## 6. 制約条件

| 制約 | 内容 |
|------|------|
| 外部API依存 | OpenWeatherMap・Google Gemini・Supabase・Google OAuthの利用規約に従う |
| ブラウザ対応 | モダンブラウザ（Chrome・Safari・Firefox・Edge 最新版）を対象とする |
| 言語 | UIは日本語のみ |
| 認証方式 | Google OAuthのみ（メール/パスワード認証は対象外） |
| Geolocation | HTTPSまたはlocalhostでのみ動作（ブラウザ仕様） |

---

## 7. 用語定義

| 用語 | 説明 |
|------|------|
| 天気概況 | OpenWeatherMapから返ってくる天気の説明文（例：「晴れ」「曇りのち雨」） |
| 活動スコア | AI（Gemini）が算出する1〜5段階の活動適性スコア |
| 都市リスト | Supabaseの`cities`テーブルに格納された検索可能な都市データ |
| セッション | Auth.js（NextAuth）が管理するログイン状態 |
| 現在地 | ブラウザのGeolocation APIで取得した緯度・経度情報 |
